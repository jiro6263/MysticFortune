# 운세 웹앱 시드 생성 시스템 전체 설계 문서

본 문서는 자유 입력 기반 운세 웹앱에서 **시드값을 안정적으로 생성하고**, 이를 통해 점수 및 결과를 일관되게 만드는 시스템을 처음부터 끝까지 정의한다.

---

## 1. 시스템 목표

* 어떤 입력이든 시드로 변환 가능
* 같은 입력 → 항상 같은 결과
* 날짜 변경 → 자동으로 새로운 결과
* 랜덤처럼 보이지만 재현 가능
* GPT 사용 여부와 무관하게 작동

---

## 2. 전체 구조 개요

```
사용자 입력
   ↓
정규화 (Normalize)
   ↓
직렬화 (Serialize)
   ↓
해싱 (Hash)
   ↓
Base Seed / Theme Seed
   ↓
Final Seed
   ↓
점수 및 설명 생성
```

---

## 3. 입력 항목 정의

### Base Seed 입력 (일별 개인 운)

* 오늘 날짜 (YYYY-MM-DD)
* 년
* 월
* 일
* 이름
* 성별

### Theme Seed 입력 (오늘 테마)

* 색
* 동물
* 사람(관계)
* 음식

---

## 4. 정규화 규칙 (Normalize)

모든 입력은 문자열로 취급하며 다음 규칙을 적용한다.

* 앞뒤 공백 제거
* 연속 공백 하나로 축소
* 줄바꿈/탭 정리
* 영문 소문자 통일
* 유니코드 NFKC 정규화
* 빈칸은 빈 문자열로 처리

목적: 같은 의미의 입력이 항상 같은 문자열로 변환되도록 유지

---

## 5. 직렬화 규칙 (Serialize)

* 필드 순서 고정
* 구분자로 특수 제어문자 사용 (\u001F 권장)

### Base 직렬화 예시

```
base_string = today | year | month | day | name | gender
```

### Theme 직렬화 예시

```
theme_string = color | animal | person | food
```

---

## 6. 해싱 시스템

* 알고리즘: SHA-256
* 출력: 16진수 문자열 → BigInt 변환

목적:

* 충돌 확률 극소화
* 점수 계산에 사용 가능한 정수화

---

## 7. 시드 구조 정의

### Base Seed

```
base_seed = H(base_string)
```

### 주제별 파생 시드

```
love_seed   = H(base_seed + "love")
money_seed  = H(base_seed + "money")
study_seed  = H(base_seed + "study")
social_seed = H(base_seed + "social")
```

### Theme Seed

```
theme_seed = H(theme_string)
```

### Final Seed

```
final_seed = H(base_seed + theme_seed)
```

---

## 8. 점수 산출 방식

### 총운 점수

```
overall_score = final_seed % 101
```

### 주제별 점수

```
topic_score = round(0.65 * (topic_seed % 101) + 0.35 * overall_score)
```

---

## 9. 점수 구간 정의

| 점수     | 등급    |
| ------ | ----- |
| 90~100 | 매우 좋음 |
| 70~89  | 좋음    |
| 40~69  | 보통    |
| 0~39   | 주의    |

---

## 10. 설명 생성 구조

결과 설명은 슬롯 방식으로 조합한다.

```
[오늘의 흐름]
[테마 반영 문장]

[연애운 설명]
[금전운 설명]
[학업운 설명]
[대인관계 설명]

[행동 조언]
[주의 포인트]
```

각 슬롯별로 다수 템플릿을 보유하고 시드 기반 선택

---

## 11. 캐시 저장 전략 (선택)

### 캐시 키

```
cache_key = hash(final_seed + prompt_version)
```

### 저장 항목

* final_seed
* 점수들
* 생성된 설명 텍스트
* 생성 일시

동일 시드 발생 시 기존 결과 반환

---

## 12. 날짜 처리 원칙

* 기준 시간대: Asia/Seoul
* 가능하면 서버 기준 날짜 사용
* 프론트 전용 MVP에서는 브라우저 시간 사용 가능

---

## 13. 버전 관리

정규화/직렬화 규칙 변경 시

```
seed_version = v1 → v2
```

기존 결과 보호 가능

---

## 14. 보안 강화 옵션 (선택)

```
seed = H(SALT + serialized_string)
```

* SALT는 서버 전용 비밀값
* 예측 방지 목적

---

## 15. 시스템 장점

* 비용 0원 운영 가능
* 결과 재현성 보장
* GPT 사용 여부와 독립적
* 무한 확장 가능

---

## 16. 최종 결론

본 시드 시스템은:

* 완전 자유 입력을 허용하면서도
* 매일 변화하는 개인화 결과를 만들고
* 안정적인 점수 및 콘텐츠 생성이 가능하다.

운세, 타로, 심리 테스트, 추천 시스템까지 모두 확장 가능한 범용 엔진이다.
